# 모델 실행 매뉴얼

팀: 정석 원서치

참가자: 김정수, 오준석, 유원상

## 목차

1. 개요
   - 목적
   - 주요 기능
2. 환경 구성
   - 구동 환경
   - 주요 라이브러리
   - 설치 방법
   - 환경 변수 설정
3. 입력/출력 구조
   - 입력 형식
   - 출력 형식
   - 예시
4. 실행 방법
   1. 데이터셋 ID 준비
   2. 파라미터 설정
   3. 모델 실행 명령어
   4. 결과 파일 확인
5. 폴더 구조
6. 주의사항
  
## **1. 개요**

### 목적

연구자 맞춤형 다각적 AI 학술자료 추천 시스템.

### 주요 기능

- 특정 논문/데이터셋 ID를 입력받아, embedding vector를 활용해 가장 관련성이 높은 3~5개의 추천 자료 목록을 반환
- 최종 추천 결과물은 자료 제목 / 설명 / URL / 관련도 점수 / 추천 사유를 포함하는 구조화된 결과물로 반환
- 모든 과정이 매우 빠른 시간 안에 작동함.

## **2. 환경 구성**

### 구동 환경

Python 3.13.2

### 주요 라이브러리

langchain(0.3.27), langgraph(0.6.8), openai(2.2.0), faiss-cpu(1.12.0) 등

### 설치 방법
```bash
pip install -r requirements.txt
```

### 환경 변수 설정

```bash
# 연구데이터 검색 API
DATAON_SEARCH_API_KEY=your_api_key_here

# 연구데이터 메타정보 상세 조회 API
DATAON_META_API_KEY=your_api_key_here

# ScienceON API
SCIENCEON_API_KEY=your_api_key_here      # ScienceON에서 발급받은 API 키
SCIENCEON_CLIENT_ID=your_client_id_here  # ScienceON에서 발급받은 클라이언트 ID
MAC_ADDRESS=your_mac_address_here        # 등록된 장비의 MAC 주소

# OpenAI
OPENAI_API_KEY=your_api_key_here
```

- API 키를 잘못 입력하거나 누락하면 모델 실행 시 인증 오류가 발생합니다.
- 오류 메시지 예시: *"환경변수(DATAON_META_API_KEY)가 비어있어요!"* 등
- 확인 방법: 각 API 키가 올바른지, 환경 변수명이 정확한지 재검토

수정 후, 터미널/콘솔을 다시 열고 실행해야 변경 사항이 적용됩니다.

## **3. 입력/출력 구조**

### 입력 형식

- 검색 ID: 논문의 CN 또는 데이터셋의 svc_id

  - 커맨드라인 인자: `--id`

  - 형식: 문자열 *(예: `JAKO200411922932805`)*

- 데이터 유형: 검색할 데이터의 종류

   - 커맨드라인 인자: `--category`

   - 값: article 또는 dataset

### 출력 형식

- 출력: 주제와 연관성이 높은 논문/데이터셋 5개의 목록

- 주요 항목
  - 구분: str, 현재 데이터가 논문/데이터셋 중 어떤 카테고리에 속해 있는지를 나타냅니다.
  - 제목: str, 현재 데이터의 제목입니다.
  - 설명: str, 데이터가 논문일 경우 초록, 데이터셋일 경우 설명을 보여줍니다.
  - 점수: float
    - 0~100점 사이에서 사용자가 검색하고자 한 데이터와의 유사도를 나타냅니다. 
    - 100점에 가까울 수록 유사도가 높습니다. 
    - 데이터는 점수에 대해 내림차순으로 정렬됩니다.
  - 추천 사유: str, LLM이 생성한 현재 데이터의 추천 사유입니다.
  - URL: 현재 데이터의 실제 URL입니다.

- 형식: JSON
    ```json
    [
        {
            "구분": "article",
            "제목": "한국인의 3차원 무릎 관절 모델 구축 및 형상 측정",
            "설명": "It is necessary to have a model that describes the feature of the knee joint with a sufficient accuracy....",
            "점수": 92.39747619628906,
            "추천 사유": "이 연구는 한국인의 3차원 무릎 관절 모델을 구축하여, 한국인에 적합한 인공관절 개발에 직접적으로 연관됩니다.",
            "URL": "http://click.ndsl.kr/servlet/OpenAPIDetailView?keyValue=05787966&target=DIKO&cn=DIKO0010027329"
        },
        ...
    ]
    ```

## **4. 실행 방법**

1. 데이터셋 ID 준비

   추천을 받고 싶은 논문의 CN, 혹은 데이터셋의 svc_id (이하 ID)를 준비합니다. 

2. 파라미터 설정

   모델 실행 전, src/config.ini 파일에서 분석 및 검색 관련 파라미터를 확인하고 필요에 따라 조정할 수 있습니다. 
   
   기본값은 권장 설정으로 미리 지정되어 있어 대부분 수정 없이 실행 가능합니다.

   - `evaluate_relevance` – 토큰 제한 관련 파라미터

      - MAX_LENGTH: description이 너무 길 경우 길이 제한 (권장: 2000)

      - batch_size: 데이터가 많을 경우 나눠서 처리 (권장: 500)

   - `weight` – 유사도 가중치

      - title_weight: title 유사도 가중치 (권장: 10)

      - desc_weight: description 유사도 가중치 (권장: 3)

      - key_weight: keyword 유사도 가중치 (권장: 1)

   - `search` – 검색 관련 설정

      - query_length: 한 번에 사용할 쿼리 개수 (권장: 5, 최대 10)

      - search_length: 쿼리당 검색할 데이터 수 (권장: 20, 최소 10~최대 100)

3. 모델 실행 명령어

   - 프로젝트 디렉토리로 이동한 후, 아래 명령어를 통해 모델을 실행할 수 있습니다.

      ```bash
      cd project/
      python src/run_agent.py --id <검색할 데이터 ID> --category <article|dataset>
      ```

   - 인자 설명

      - `--id`

         검색할 데이터의 고유 ID를 입력합니다. *예: `JAKO200411922932805`*

      - `--category`
   
         검색할 데이터의 유형을 선택합니다. 반드시 article 또는 dataset 중 하나를 입력해야 합니다.

4. 결과 파일 확인
   
   결과 데이터는 `results/` 폴더 안의 `analysis_result.json` 파일에 저장됩니다.

## **5. 폴더 구조**

```text
project/
│
├─ data/
│   ├─ input_data.json              # 입력 ID에 대한 실제 논문/데이터셋 정보입니다.
│   ├─ queries.txt                  # 논문/데이터셋 검색을 위한 쿼리입니다.
│   ├─ search_results_article.csv   # 논문 검색 결과입니다.
│   ├─ search_results_dataset.csv   # 데이터셋 검색 결과입니다.
│   └─ relevance_results.csv        # 연관성 상위 데이터에 대한 점수 계산과 추천 사유 생성 결과입니다. 
│
├─ src/
│   ├─ graph/
│   │   ├─ __init__.py
│   │   ├─ builder.py               # 랭그래프 그래프 구조입니다.
│   │   └─ global_state.py          # 랭그래프 state 선언입니다.
│   │
│   ├─ models/
│   │   ├─ __init__.py
│   │   ├─ browse.py                # 입력 ID에 대해 검색 실행 및 쿼리 생성을 위한 노드입니다.
│   │   ├─ search.py                # 쿼리에 대한 논문 및 데이터셋 검색을 위한 노드입니다.
│   │   └─ relevance.py             # 검색 결과에서 유사도 검색 및 선정 사유 생성, 결과 정리를 위한 노드입니다.
│   │
│   ├─ prompts/
│   │   ├─ __init__.py
│   │   ├─ query_prompt.py          # 쿼리 검색을 위한 프롬프트입니다.
│   │   └─ relevance_propmpt.py     # 선정 사유 생성을 위한 프롬프트입니다.
│   │
│   ├─ utils/
│   │   ├─ __init__.py
│   │   ├─ func.py                  # xml 파일을 df로 변환하는 함수 등
│   │   ├─ scienceon_api.py         # ScienceON 검색을 위한 access token을 생성하기 위한 파일입니다.
│   │   └─ config_loader.py         # 하이퍼파라미터 설정을 위한 파일입니다.
│   │
│   └─ run_agent.py                 # 실행파일
│
├─ results/
│   └─ analysis_result.json         # 결과파일
│
├─ requirements.txt
└─ README.md
```

## **6. 주의사항**

- 검색 대상이 데이터셋인 경우 `dataset`, 논문인 경우 `article`로 정확히 구분하여 입력해야 합니다.
  - 다른 값을 입력하면 실행시 에러가 발생할 수 있습니다.

- 모델이 반환하는 결과는 유사도 기준일 뿐, 절대적 정확성을 보장하지 않습니다.

- 또한, 추천 사유는 LLM이 생성한 참고용일 뿐, 절대적 판단 기준이 아닙니다.